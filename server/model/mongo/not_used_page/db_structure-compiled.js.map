{"version":3,"sources":["db_structure.js"],"names":[],"mappings":"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","file":"db_structure-compiled.js","sourcesContent":["/**\r\n * Created by wzhan039 on 2015-07-08.\r\n */\r\n//var inputDefine=require('../assist/input_define').inputDefine;\r\nvar uploadDefine=require('../assist/upload_define').uploadDefine;\r\nvar ueditor_config=require('../assist/ueditor_config').ue_config;\r\nvar input_validate=require('../error_define/input_validate').input_validate;\r\nvar micellaneous=require('../assist_function/miscellaneous').func\r\nvar instMongo=require('./dbConnection');\r\nvar mongoose=instMongo.mongoose;\r\n\r\n\r\nvar schemaOptions={\r\n    autoIndex:false,\r\n    bufferCommands:false,\r\n    _id:true,//用mongoose产生objectId\r\n    minimize:true,\r\n    safe:true,\r\n    Strict:false,//set as false, so if a field not set value, still can be saved into db\r\n    validateBeforeSave:false\r\n};\r\n//convert mongodb data to objext, so that nodejs can manipulate directly\r\nvar toObjectOptions={\r\n    getters:true,//apply all getters (path and virtual getters)\r\n    virtuals:true,//apply virtual getters (can override getters option)\r\n    minimize:true,// remove empty objects (defaults to true)\r\n    depopulate:false,//depopulate any populated paths, replacing them with their original refs (defaults to false)\r\n    versionKey:false,//whether to include the version key (defaults to true)        //not include version key in result\r\n    retainKeyOrder:false // keep the order of object keys. If this is set to true, Object.keys(new Doc({ a: 1, b: 2}).toObject()) will always produce ['a', 'b'] (defaults to false)\r\n}\r\n\r\n/*                              user                        */\r\nvar userSch=new mongoose.Schema({\r\n        name:{type:String, unique:true},\r\n        password:String,\r\n        mobilePhone:Number,\r\n        thumbnail:{type:String,default:'b10e366431927231a487f08d9d1aae67f1ec18b4.png'},\r\n        //articles:[{type:mongoose.Schema.Types.ObjectId,ref:'articles'}],\r\n        cDate:{type:Date,default:Date()},\r\n        mDate:{type:Date,default:Date()},\r\n        dDate:Date\r\n    },\r\n    schemaOptions\r\n);\r\n\r\nuserSch.set('toObject',toObjectOptions)\r\n\r\nuserSch.path('name').validate(function(value){\r\n    if(input_validate.user.name.require.define){\r\n        return input_validate.user.name.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.user.name.type.define.test(value))\r\n    }\r\n})\r\n//password had been hashed\r\nuserSch.path('password').validate(function(value){\r\n    if(input_validate.user.password.require.define){\r\n        return input_validate.user.password.encryptedPassword.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.user.password.encryptedPassword.define.test(value))\r\n    }\r\n})\r\nuserSch.path('mobilePhone').validate(function(value){\r\n    if(input_validate.user.mobilePhone.require.define){\r\n        return input_validate.user.mobilePhone.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.user.mobilePhone.type.define.test(value))\r\n    }\r\n})\r\nuserSch.path('thumbnail').validate(function(value){\r\n    if(input_validate.user.thumbnail.require.define){\r\n        return input_validate.user.thumbnail.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.user.thumbnail.type.define.test(value))\r\n    }\r\n})\r\nuserSch.virtual('mDateConv').get(function(){\r\n    return this.mDate.toLocaleString()\r\n    //return this.mDate.toLocaleDateString()+' '+this.mDate.toLocaleTimeString()\r\n})\r\n/*userSch.virtual('cDateConv').get(function(){\r\n    return this.cDate.toLocaleString()\r\n    //return this.mDate.toLocaleDateString()+' '+this.mDate.toLocaleTimeString()\r\n})*/\r\nvar userModel=mongoose.model('users',userSch)//mongoose auto convert user to users, so directly use users as collection name\r\n\r\n\r\n\r\n/*                              key                             */\r\nvar keySch=new mongoose.Schema({\r\n    key:{type:String,unique:true},\r\n    cDate:Date,\r\n    mDate:{type:Date,default:Date()},\r\n    dDate:Date\r\n},schemaOptions);\r\nkeySch.set('toObject',toObjectOptions);\r\n\r\nkeySch.path('key').validate(function(value){\r\n    if(input_validate.key.key.require.define){\r\n        return input_validate.key.key.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.key.key.type.define.test(value))\r\n    }\r\n})\r\nvar keyModel=mongoose.model('keys',keySch);\r\n\r\n/*                              attachment                             */\r\nvar attachmentSch=new mongoose.Schema({\r\n    hashName:{type:String,unique:true},//hashName sha1 40+4 ~ 40+5\r\n    name:String,//100  compatilbe with windows\r\n    storePath:String,// 1024 for linux(don't care windows,since server use Linux as OS)\r\n    size:Number,//in byte\r\n    cDate:Date,\r\n    mDate:{type:Date,default:Date()},\r\n    dDate:Date\r\n},schemaOptions);\r\nattachmentSch.set('toObject',toObjectOptions);\r\nattachmentSch.path('hashName').validate(function(value){\r\n    if(input_validate.attachment.hashName.require.define){\r\n        return input_validate.attachment.hashName.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.attachment.hashName.type.define.test(value))\r\n    }\r\n    //return (value != null && value.length>=input_validate.attachment.hashName.minLength.define && value.length<=input_validate.attachment.hashName.maxLength.define );// 44 ~ 45,后缀为3～4个字符\r\n});\r\nattachmentSch.path('name').validate(function(value){\r\n    return (value != null && value.length<input_validate.attachment.name.maxLength.define &&  value.length>=input_validate.attachment.name.minLength.define);\r\n});\r\nattachmentSch.path('storePath').validate(function(value){\r\n    return (value != null && value.length<input_validate.attachment.storePath.maxLength.define);\r\n});\r\nattachmentSch.path('size').validate(function(value){\r\n    if(input_validate.attachment.size.define){\r\n        return ((value != null) && (value<input_validate.attachment.size.maxLength.define));\r\n    }else{\r\n        return ((value === null) || (value<input_validate.attachment.size.maxLength.define));\r\n    }\r\n});\r\n\r\nattachmentSch.virtual('cDateConv').get(function(){\r\n    return this.cDate.toLocaleString()\r\n    //return this.mDate.toLocaleDateString()+' '+this.mDate.toLocaleTimeString()\r\n})\r\nvar attachmentModel=mongoose.model('attachments',attachmentSch);\r\n\r\n/*                          inner_image                                 */\r\n/*\r\n*   用户可能upload图片后又删除，所以需要对上传的文本和数据库进行同步\r\n*   因此需要单独表（而不是和attachment混在一起，否则处理麻烦）\r\n*   结构和attachment基本一致\r\n* */\r\nvar innerImageSch=new mongoose.Schema({\r\n    hashName:{type:String,unique:true},//sha1 40+5\r\n    name:String,//100   compatilbe with windows\r\n    storePath:String,// 1024 for linux(don't care windows,since server use Linux as OS)\r\n    size:Number,//in byte\r\n    cDate:Date,\r\n    mDate:{type:Date,default:Date()},\r\n    dDate:Date\r\n},schemaOptions);\r\ninnerImageSch.set('toObject',toObjectOptions);\r\ninnerImageSch.path('hashName').validate(function(value){\r\n    if(input_validate.innerImage.hashName.require.define){\r\n        return input_validate.innerImage.hashName.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.innerImage.hashName.type.define.test(value))\r\n    }\r\n    //return (value != null && value.length>=input_validate.innerImage.hashId.minLength.define && value.length<=input_validate.innerImage.hashId.maxLength.define);//44 ~ 45,后缀为3～4个字符\r\n});\r\ninnerImageSch.path('name').validate(function(value){\r\n    return (value != null && value.length<input_validate.innerImage.name.maxLength.define && value.length>=input_validate.innerImage.name.minLength.define);\r\n});\r\ninnerImageSch.path('storePath').validate(function(value){\r\n    return (value != null && value.length<input_validate.innerImage.storePath.maxLength.define);\r\n});\r\ninnerImageSch.path('size').validate(function(value){\r\n    return ((value != null) && (value<=input_validate.innerImage.size.maxLength.define));//此处采用ueditor_config中的设置\r\n});\r\n\r\ninnerImageSch.virtual('mDateConv').get(function(){\r\n    return this.mDate.toLocaleString()\r\n    //return this.mDate.toLocaleDateString()+' '+this.mDate.toLocaleTimeString()\r\n})\r\n\r\nvar innerImageModel=mongoose.model('innerImages',innerImageSch);\r\n\r\n\r\n/*                          comment                                 */\r\n/*\r\n *   传统方式，无父-子关系\r\n * */\r\nvar commentSch=new mongoose.Schema({\r\n    //_id:mongoose.Schema.Types.ObjectId,\r\n    //为了方便populate出user的内容，需要添加articleId，以便直接查找comment，然后populate\r\n    articleId:{type:mongoose.Schema.Types.ObjectId,ref:\"articles\"},\r\n    user:{type:mongoose.Schema.Types.ObjectId,ref:\"users\"},\r\n    content:String,// 255\r\n    cDate:Date,\r\n    mDate:{type:Date,default:Date()},\r\n    dDate:Date\r\n},schemaOptions);\r\ncommentSch.set('toObject',toObjectOptions);\r\ncommentSch.path('articleId').validate(function(value){\r\n    if(input_validate.comment.articleId.require.define){\r\n        return input_validate.comment.articleId.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.comment.articleId.type.define.test(value))\r\n    }\r\n    //return (value != null || input_validate.comment.articleId.type.define.test(value));\r\n});\r\ncommentSch.path('user').validate(function(value){\r\n    //return (value != null || value.length<input_validate.comment.user.type.define.test(value));\r\n    if(input_validate.comment.user.require.define){\r\n        return input_validate.comment.user.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.comment.user.type.define.test(value))\r\n    }\r\n});\r\ncommentSch.path('content').validate(function(value){\r\n    return (value == null || value.length<input_validate.comment.content.maxLength.define);\r\n});\r\n\r\ncommentSch.virtual('mDateConv').get(function(){\r\n    return this.mDate.toLocaleString()\r\n    //return this.mDate.toLocaleDateString()+' '+this.mDate.toLocaleTimeString()\r\n})\r\nvar commentModel=mongoose.model('comments',commentSch);\r\n\r\n/*                                      article                                  */\r\nvar articleSch=new mongoose.Schema({\r\n    //_id:objectId(),\r\n    hashId:{type:String,unique:true}, //hash id 40\r\n    title:String,\r\n    state:{type:String,enum:['正在编辑','编辑完成'],default:'正在编辑'},\r\n    author:{type:mongoose.Schema.Types.ObjectId,ref:\"users\"},\r\n    //keys:[{type:mongoose.Schema.Types.ObjectId,ref:'keys'}],\r\n    keys:[String],\r\n    innerImage:[{type:mongoose.Schema.Types.ObjectId,ref:'innerImages'}], //采用_id作为外键\r\n    attachment:[{type:mongoose.Schema.Types.ObjectId,ref:'attachments'}],\r\n    pureContent:String,\r\n    htmlContent:String,\r\n    comment:[{type:mongoose.Schema.Types.ObjectId,ref:'comments'}],\r\n    cDate:Date,\r\n    mDate:{type:Date,default:Date()},\r\n    dDate:Date\r\n}, schemaOptions);\r\narticleSch.set('toObject',toObjectOptions);\r\narticleSch.path('hashId').validate(function(value){\r\n    if(input_validate.article.hashId.require.define){\r\n        return input_validate.article.hashId.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.article.hashId.type.define.test(value))\r\n    }\r\n    //return value!=null && input_validate.article.hashId.type.define.test(value);\r\n})\r\narticleSch.path('title').validate(function(value){\r\n    return value!=null && value.length>=input_validate.article.title.minLength.define && value.length<=input_validate.article.title.maxLength.define ;\r\n})\r\narticleSch.path('author').validate(function(value){\r\n    if(input_validate.article.author.require.define){\r\n        return input_validate.article.author.type.define.test(value)\r\n    }else{\r\n        return (null===value || input_validate.article.author.type.define.test(value))\r\n    }\r\n    //return value!=null && input_validate.article.author.type.define.test(value)\r\n})\r\narticleSch.path('keys').validate(function(value){\r\n    if( value==[] || null===value ){return true}\r\n    if(value.length<=input_validate.article.keys.maxSize.define){\r\n        for(var i=0;i<value.length;i++){\r\n            if(!input_validate.article.keys.type.define.test(value[i])){\r\n                return false\r\n            }\r\n        }\r\n    }\r\n    return true\r\n})\r\n\r\narticleSch.path('innerImage').validate(function(value){\r\n    if( value==[] || null===value ){return true}\r\n    if(value.length<=input_validate.article.innerImage.maxSize.define){\r\n        for(var i=0;i<value.length;i++){\r\n            if(!input_validate.article.innerImage.type.define.test(value[i])){\r\n                return false\r\n            }\r\n        }\r\n    }\r\n    return true\r\n})\r\narticleSch.path('attachment').validate(function(value){\r\n    if( value==[] || null===value ){return true}\r\n    if(value.length<=input_validate.article.attachment.maxSize.define){\r\n        for(var i=0;i<value.length;i++){\r\n            if(!input_validate.article.attachment.type.define.test(value[i])){\r\n                return false\r\n            }\r\n        }\r\n    }\r\n    return true\r\n})\r\narticleSch.path('pureContent').validate(function(value){\r\n    return null===value || value.length<input_validate.article.pureContent.maxLength.define\r\n})\r\narticleSch.path('htmlContent').validate(function(value){\r\n    return null===value || value.length<input_validate.article.htmlContent.maxLength.define;\r\n})\r\n\r\narticleSch.virtual('mDateConv').get(function(){\r\n    return this.mDate.toLocaleString()\r\n})\r\ninnerImageSch.virtual('cDateConv').get(function(){\r\n    return this.cDate.toLocaleString()\r\n    //return this.mDate.toLocaleDateString()+' '+this.mDate.toLocaleTimeString()\r\n})\r\n\r\nvar articleModel=mongoose.model('articles',articleSch);\r\n//var commentModel=mongoose.model('comment',commentSch);\r\n\r\n/*                  folder                      */\r\nvar folderSch=new mongoose.Schema({\r\n        folderName:{type:String},//255 infact, in Linux, the max lenght can be 1024, but for easy to use, just use 255\r\n        owner:{type:mongoose.Schema.Types.ObjectId,ref:'users'},\r\n        parentId:{type:mongoose.Schema.Types.ObjectId,ref:'folders'},\r\n        level:Number,//当前目录的层数,从1开始计算\r\n        cDate:Date,\r\n        mDate:{type:Date,default:Date()},\r\n        dDate:Date\r\n    },\r\n    schemaOptions\r\n);\r\nfolderSch.set('toObject',toObjectOptions)\r\nfolderSch.path('folderName').validate(function(value){\r\n    return (value!=null && input_validate.folder.folderName.type.define.test(value))\r\n})\r\nfolderSch.path('owner').validate(function(value){\r\n    return (value!=null && input_validate.folder.owner.type.define.test(value))\r\n})\r\nfolderSch.path('parentId').validate(function(value){\r\n    //对于用户的根目录,是没有parent目录的\r\n    return (value==null || input_validate.folder.parentId.type.define.test(value))\r\n})\r\nfolderSch.path('level').validate(function(value){\r\n    return (value!=null && input_validate.folder.level.range.define.min<=value &&  input_validate.folder.level.range.define.max>=value)\r\n})\r\nfolderSch.virtual('mDateConv').get(function(){\r\n    return this.mDate.toLocaleString()\r\n})\r\n/*folderSch.virtual('cDateConv').get(function(){\r\n    return this.cDate.toLocaleString()\r\n})*/\r\nvar folderModel=mongoose.model('folders',folderSch);\r\n\r\n/**********************************************************************/\r\n/**********************************************************************/\r\n/*                          relation                                    */\r\n/**********************************************************************/\r\n/**********************************************************************/\r\n\r\n\r\n/*                      key-article                                     */\r\n//为了搜索方便\r\nvar keyArticleSch=new mongoose.Schema({\r\n    articleId:{type:mongoose.Schema.Types.ObjectId,ref:'articles'},\r\n    keyId:{type:mongoose.Schema.Types.ObjectId,ref:'keys'}\r\n},schemaOptions)\r\nkeyArticleSch.set('toObject',toObjectOptions)\r\nkeyArticleSch.path('articleId').validate(function(value){\r\n    return (value!=null && input_validate.keyArticle.articleId.validateError.define.test(value))\r\n})\r\nkeyArticleSch.path('keyId').validate(function(value){\r\n    return (value!=null && input_validate.keyArticle.keyId.validateError.define.test(value))\r\n})\r\nvar keyArticleModel=mongoose.model('keyArticles',keyArticleSch);\r\n\r\n\r\n/*                           article in folder                       */\r\nvar articleFolderSch=new mongoose.Schema({\r\n        articleId:{type:mongoose.Schema.Types.ObjectId,ref:'articles'},\r\n        folderId:{type:mongoose.Schema.Types.ObjectId,ref:'personalArticles'},\r\n        cDate:Date,\r\n        mDate:{type:Date,default:Date()},\r\n        dDate:Date\r\n    },\r\n    schemaOptions\r\n);\r\narticleFolderSch.set('toObject',toObjectOptions)\r\narticleFolderSch.path('articleId').validate(function(value){\r\n    return (value!=null &&input_validate.articleFolder.articleId.type.define.test(value))\r\n})\r\narticleFolderSch.path('folderId').validate(function(value){\r\n    return (value!=null &&input_validate.articleFolder.folderId.type.define.test(value))\r\n})\r\nvar articleFolderModel=mongoose.model('articleFolders',articleFolderSch);\r\n\r\n\r\nvar errorSch=new mongoose.Schema({\r\n    errorCode:Number, //new define file\r\n    errorMsg:String, //new define file\r\n    category:String,// which page\r\n    subCategory:String,\r\n    desc:String,//more detail information\r\n    priority:String,\r\n    cDate:Date,\r\n    mDate:{type:Date,default:Date()},\r\n    dDate:Date\r\n},schemaOptions);\r\nerrorSch.set('toObject',toObjectOptions);\r\nvar errorModel=mongoose.model('errors',errorSch);\r\n\r\n\r\n\r\n\r\n\r\nexports.userModel=userModel;\r\nexports.articleModel=articleModel;\r\nexports.keyModel=keyModel;\r\nexports.attachmentModel=attachmentModel;\r\nexports.innerImageModel=innerImageModel;\r\nexports.errorModel=errorModel;\r\nexports.commentModel=commentModel;\r\nexports.folderModel=folderModel;\r\nexports.keyArticleModel=keyArticleModel;\r\nexports.articleFolderModel=articleFolderModel\r\n//exports.readArticle=readArticle;"]}