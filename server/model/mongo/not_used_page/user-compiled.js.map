{"version":3,"sources":["user.js"],"names":[],"mappings":"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","file":"user-compiled.js","sourcesContent":["/**\r\n * Created by wzhan039 on 2015-09-29.\r\n */\r\nvar userModel=require('./db_structure').userModel;\r\nvar errorRecorder=require('../express_component/recorderError').recorderError;\r\nvar input_validate=require('../error_define/input_validate').input_validate\r\nvar runtimeDbError=require('../error_define/runtime_db_error').runtime_db_error\r\nvar runtimeNodeError=require('../error_define/runtime_node_error').runtime_node_error\r\nvar validateDb=require('../error_define/3rd_party_error_define').validateDb;\r\n\r\nvar checkUserValidate=function(name,cryptPwd,callback){\r\n    userModel.find({'name':name,'password':cryptPwd},function(err,result){\r\n        //throw err\r\n        if(err) {\r\n            //throw err\r\n            errorRecorder({rc:err.code,msg:err.errmsg},'login','countUser')\r\n            return callback(err,runtimeDbError.user.findUser)\r\n        }\r\n//console.log(result)\r\n        if(0===result.length){\r\n            return callback(null,runtimeDbError.user.findNoUserWhenLogin)\r\n        }\r\n        if(1<result.length){\r\n            return callback(null,runtimeDbError.user.findMultiUserWhenLogin)\r\n        }\r\n//console.log(result[0])\r\n        if(1===result.length){\r\n            return callback(null,{rc:0,msg:result[0]})\r\n        }\r\n\r\n    })\r\n}\r\n\r\nvar addUser=function(name,password,mobilePhone,callback){\r\n    var user=new userModel();\r\n    user.name=name\r\n    user.password=password;\r\n//console.log(user)\r\n    if(null!=mobilePhone || undefined!=mobilePhone){\r\n        user.mobilePhone=mobilePhone;\r\n    }\r\n\r\n    user.cDate=new Date();\r\n\r\n    validateDb.user(user,'register','addUser',function(validateErr,validateResult){\r\nconsole.log(validateErr)\r\nconsole.log(validateResult)\r\n        if(0<validateResult.result){\r\n            return callback(validateErr,validateResult);\r\n        }\r\n//console.log(user)\r\n        userModel.count({'name': name}, function (err, result) {\r\n            if (err) {\r\n                errorRecorder(err.code,err.errmsg,'register','countUser')\r\n                return callback(err,runtimeDbError.user.count)\r\n                //return res.json(mongooseError.countUser)\r\n            }\r\n//console.log(result)\r\n//                if(null===result){\r\n//                    return callback(null,true)\r\n//                }\r\n            if(result.rc>0){\r\n                return callback(null,runtimeNodeError.user.userAlreadyExist)               //return res.json({rc: 3, msg:\"用户名已存在\"})\r\n            }\r\n            user.save(function(err,addedUser,num){\r\n                if (err){\r\n                    errorRecorder({rc:err.code,msg:err.errmsg},'register','saveUser')\r\n                    return callback(err,runtimeDbError.user.save)\r\n                }\r\n                    return callback(null,{rc:0,msg:addedUser._id})\r\n\r\n            });\r\n\r\n        });\r\n\r\n    })\r\n\r\n\r\n};\r\n\r\nexports.userDbOperation={\r\n    checkUserValidate:checkUserValidate,\r\n    addUser:addUser\r\n}"]}