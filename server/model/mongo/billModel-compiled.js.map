{"version":3,"sources":["billModel.js"],"names":[],"mappings":"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","file":"billModel-compiled.js","sourcesContent":["/**\r\n * Created by Ada on 2016/9/28.\r\n */\r\n'use strict'\r\nvar billModel=require('./common/structure-compiled').billModel\r\nvar mongooseErrorHandler=require('../../define/error/mongoError').mongooseErrorHandler\r\n\r\nvar pageSetting=require('../../config/global/globalSettingRule').pageSetting\r\n\r\nfunction create(values){\r\n    //不能直接返回promise，而是通过callback捕获可能错误，并转换成可读格式\r\n    //return billModel.insertMany(values)\r\n    return new Promise(function(resolve,reject){\r\n        console.log(`inserted values ${values}`)\r\n\r\n        billModel.insertMany(values,function(err,result){\r\n            if(err){\r\n                //console.log(JSON.stringify(err))\r\n                //能返回自定义错误，所以用resolve而不是reject\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n            resolve({rc:0,msg:result})\r\n        })\r\n    })\r\n}\r\nfunction update(id,values){\r\n    var updateOptions={\r\n        'new':false,//是否返回更新后的doc。默认false，返回原始doc\r\n        'select':'', //返回哪些字段\r\n        'upsert':false,//如果doc不存在，是否创建新的doc，默认false\r\n        runValidators:false,//更新时是否执行validator。因为默写cavert，默认false\r\n        setDefaultsOnInsert:false,//当upsert为true && 设为true，则插入文档时，使用default。\r\n        'sort':'_id',//如果找到多个文档（应该不太可能），按照什么顺序选择第一个文档进行update。\r\n    }\r\n    values['uDate']=Date.now()\r\n    return new Promise(function(resolve,reject){\r\n        billModel.findByIdAndUpdate(id,values,updateOptions,function(err,result){\r\n            if(err){\r\n                //console.log(`db err is ${err}`)\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n\r\n            //update成功，返回的是原始记录，需要转换成可辨认格式\r\n            resolve({rc:0})\r\n        })\r\n    })\r\n}\r\n\r\n//根据Id删除文档\r\nfunction remove(id){\r\n    return new Promise(function(resolve,reject){\r\n        billModel.findByIdAndRemove(id,function(err,result){\r\n            if(err){\r\n                //console.log(`db err is ${err}`)\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n            //console.log(`success result is ${result}`)\r\n            //remove成功，返回的是原始记录，需要转换成可辨认格式\r\n            resolve({rc:0})\r\n        })\r\n    })\r\n}\r\n\r\n//只做测试用\r\nfunction removeAll(){\r\n    return new Promise(function(resolve,reject){\r\n        billModel.remove({},function(err,result){\r\n            if(err){\r\n                console.log(`bill removeAll err is ${err}`)\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n            //console.log(`success result is ${result}`)\r\n            //remove成功，返回的是原始记录，需要转换成可辨认格式\r\n            resolve({rc:0})\r\n        })\r\n    })\r\n}\r\n\r\nfunction readAll(){\r\n    return new Promise(function(resolve,reject){\r\n        let condition={}\r\n        let selectField=null\r\n        let option={}\r\n        option.limit=pageSetting.billType.limit\r\n\r\n        var opt={\r\n            path:'billType  reimburser',//需要populate的字段\r\n            select:'name',//populate后，需要显示的字段\r\n            match:{},//populate后，过滤字段(不符合这显示null)。一般不用\r\n            options:{},//{sort:{name:-1}}\r\n        }\r\n        option.limit=pageSetting.bill.limit\r\n        billModel.find(condition,selectField,option).populate(opt).exec(function (err,result) {\r\n            if(err){\r\n                console.log(`db err is ${err}`)\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n            resolve({rc:0,msg:result})\r\n        })\r\n    })\r\n}\r\n\r\nfunction readName(nameToBeSearched){\r\n    return new Promise(function(resolve,reject){\r\n        let condition={}\r\n        if(undefined!==nameToBeSearched && ''!== nameToBeSearched.toString()){\r\n            condition['name']=new RegExp(nameToBeSearched)\r\n        }\r\n        let selectField='name'\r\n        let option={}\r\n        option.limit=pageSetting.billType.limit\r\n        billModel.find(condition,selectField,option,function(err,result){\r\n            if(err){\r\n                //console.log(`db err is ${err}`)\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n            //console.log(`success result is ${result}`)\r\n            resolve({rc:0,msg:result})\r\n        })\r\n    })\r\n}\r\n\r\n//作为外键时，是否存在\r\nfunction findById(id){\r\n    return new Promise(function(resolve,reject){\r\n        billModel.find(id,'-cDate -uDate -dDate',function(err,result){\r\n            if(err){\r\n                //console.log(`db err is ${err}`)\r\n                resolve( mongooseErrorHandler(err))\r\n            }\r\n            resolve({rc:0,msg:result})\r\n        })\r\n    })\r\n}\r\nmodule.exports={\r\n    create,\r\n    update,\r\n    remove,\r\n    removeAll,\r\n    readAll,\r\n    readName,\r\n    findById,\r\n}"]}