{"version":3,"sources":["shaLua.js"],"names":[],"mappings":"AAAA;;;AAGA;;;;AAIA;;;yDAiBA,iBAA6B,IAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAKsB,QAAQ,aAAR,CAAsB,IAAtB,CALtB;;AAAA;AAKQ,+BALR;AAAA;AAAA,+BAOkB,eAAe,OAAf,CAPlB;;AAAA;AAOQ,2BAPR;AAAA,yDAQW,GARX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAe,a;;;;;;0DAWf,kBAA+B,IAA/B;AAAA;;AAAA;AAAA;AAAA;AAAA;AACQ,oCADR,GACqB,EADrB;AAEQ,uCAFR,GAEwB,EAFxB;AAGQ,6BAHR,WAGc,MAHd;AAAA;AAAA,+BAIgB,QAAQ,UAAR,CAAmB,IAAnB,CAJhB;;AAAA;AAII,6BAJJ;;AAAA,6BAKO,KALP;AAAA;AAAA;AAAA;;AAAA;AAAA,+BAM6B,QAAQ,YAAR,CAAqB,IAArB,CAN7B;;AAAA;AAMY,kCANZ;AAAA;AAAA;AAAA;AAAA;AAAA,oCAOiC,UAPjC;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOgB,qCAPhB;;AAQY;AACI,kCAThB,GAS8B,IAT9B,SASsC,aATtC;AAAA;AAAA,+BAUyB,QAAQ,WAAR,CAAoB,UAApB,CAVzB;;AAAA;AAUY,8BAVZ;;AAAA,6BAWe,MAXf;AAAA;AAAA;AAAA;;AAAA;AAAA,+BAYsC,cAAc,UAAd,CAZtC;;AAAA;AAYgB,uCAZhB;;AAagB,qCAAa,UAAb,IAAyB,eAAzB;AACA;AAdhB;;AAAA;AAAA;AAAA,+BAiBwB,QAAQ,UAAR,CAAmB,UAAnB,CAjBxB;;AAAA;AAiBY,6BAjBZ;;AAAA,6BAkBe,KAlBf;AAAA;AAAA;AAAA;;AAAA;AAAA,+BAmBoC,gBAAgB,UAAhB,CAnBpC;;AAAA;AAmBoB,iCAnBpB;;AAoBgB,6BAAQ,GAAR,IAAe,SAAf,EAAyB;AACrB,yCAAa,GAAb,IAAkB,UAAU,GAAV,CAAlB;AACH;;AAtBjB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA,0DA0BW,YA1BX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAe,e;;;;;;;AA3Bf,QAAQ,gBAAR;AACA,QAAQ,qBAAR;AACA,IAAI,UAAQ,QAAQ,iCAAR,EAA2C,OAAvD;AACA,IAAI,eAAa,QAAQ,+BAAR,EAAyC,UAAzC,CAAoD,QAArE;AACA,IAAI,gBAAc,QAAQ,+CAAR,EAAyD,aAA3E;;AAEA;AACA,SAAS,cAAT,CAAwB,aAAxB,EAAsC;AAClC,WAAO,IAAI,OAAJ,CAAY,UAAS,OAAT,EAAiB,MAAjB,EAAwB;AACvC,sBAAc,MAAd,CAAqB,MAArB,EAA4B,aAA5B,EAA0C,UAAC,GAAD,EAAK,GAAL,EAAW;AACjD,gBAAG,GAAH,EAAO;AAAC,uBAAO,aAAa,OAAb,EAAP;AAA+B;AACvC,oBAAQ,GAAR;AACH,SAHD;AAIH,KALM,CAAP;AAMH;;AA0CD,OAAO,OAAP,GAAe;AACX,gCADW;AAEX;AAFW,CAAf","file":"shaLua-compiled.js","sourcesContent":["/**\r\n * Created by wzhan039 on 2016-09-23.\r\n */\r\n/*\r\n*  把redis的Lua脚本sha化，存入内存\r\n*  单独一个文件，容易调试\r\n* */\r\n'use strict'\r\nrequire(\"babel-polyfill\");\r\nrequire(\"babel-core/register\")\r\nvar asyncFs=require('../wrapAsync/node/wrapAsyncNode').asyncFs\r\nvar ioredisError=require('../../define/error/redisError').redisError.cmdError\r\nvar ioredisClient=require('../../model/redis/connection/redis_connection').ioredisClient\r\n\r\n//将文件的 内容 sha化\r\nfunction shaFileContent(scriptContent){\r\n    return new Promise(function(resolve,reject){\r\n        ioredisClient.script('load',scriptContent,(err,sha)=>{\r\n            if(err){reject(ioredisError.shaFail())}\r\n            resolve(sha)\r\n        })\r\n    })\r\n}\r\n\r\nasync function shaSingleFile(file){\r\n    // let fileExist=await asyncFs.asyncIsDir(file)\r\n    // console.log(fileExist)\r\n    // fileExist.then((v)=>console.log(v),(e)=>console.log(e))\r\n\r\n    let content=await asyncFs.asyncReadFile(file)\r\n    // console.log(content)\r\n    let sha=await shaFileContent(content)\r\n    return sha\r\n}\r\n\r\nasync function shaLuaFileOrDir(path){\r\n    let allShaResult={}\r\n    let singleShaResult=''\r\n    let isDir,isFile\r\n    isDir=await asyncFs.asyncIsDir(path)\r\n    if(isDir){\r\n        let dirContent=await asyncFs.asyncReadDir(path)\r\n        for(let singleFileDir of dirContent){\r\n            //需要提供路径（目录+文件名）\r\n            let tmpFileDir=`${path}/${singleFileDir}`\r\n            isFile=await asyncFs.asyncIsFile(tmpFileDir)\r\n            if(isFile){\r\n                singleShaResult=await shaSingleFile(tmpFileDir)\r\n                allShaResult[tmpFileDir]=singleShaResult\r\n                // console.log(tmpFileDir+':'+singleShaResult)\r\n                continue\r\n            }\r\n            isDir=await asyncFs.asyncIsDir(tmpFileDir)\r\n            if(isDir){\r\n                let dirResult=await shaLuaFileOrDir(tmpFileDir)\r\n                for(let key in dirResult){\r\n                    allShaResult[key]=dirResult[key]\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return allShaResult\r\n}\r\n\r\nmodule.exports={\r\n    shaSingleFile,\r\n    shaLuaFileOrDir,\r\n}\r\n"]}